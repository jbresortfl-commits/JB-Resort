<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JB Resort â€” Guestbook</title>

  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>

  <style>
    :root{
      --page-max: 1200px;
      --gap: 16px;
      --border: 1px solid #ddd;
      --radius: 12px;
      --pad: 14px;
      --header-h: 180px;
      --shadow: 0 1px 6px rgba(0,0,0,0.06);
    }

    body{
      margin: 0;
      font-family: Arial, sans-serif;
      background: #fafafa;
      color: #111;
    }

    .page{
      min-height: 100vh;
      display: grid;
      grid-template-rows: var(--header-h) 1fr;
    }

    main{
      display: flex;
      justify-content: center;
      padding: var(--gap);
    }

    .content{
      width: 100%;
      max-width: var(--page-max);
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: var(--gap);
      align-items: start;
    }

    .panel{
      background: #fff;
      border: var(--border);
      border-radius: var(--radius);
      padding: var(--pad);
      box-shadow: var(--shadow);
    }

    .panel h2{
      margin: 0 0 10px 0;
      font-size: 16px;
    }

    .muted{
      color: #555;
      font-size: 13px;
      line-height: 1.45;
    }

    .panel-sub{
      color: #444;
      margin: 0 0 12px 0;
      font-size: 13px;
    }

    table.dataTable thead th { white-space: nowrap; }

    #filters-row{
      display: flex;
      justify-content: flex-end;
      margin-bottom: 6px;
    }

    #category-filter label{
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: normal;
    }

    #categoryFilter{
      padding: 4px 6px;
      font-size: 13px;
    }

    .dataTables_filter{
      margin-bottom: 10px;
      float: right;
      text-align: right;
    }

    .photo-thumb{
      width: 40px;
      height: 40px;
      object-fit: cover;
      border-radius: 4px;
      display: block;
      margin: 0 auto;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    .photo-thumb:hover{
      transform: scale(1.15);
      box-shadow: 0 2px 8px rgba(0,0,0,0.25);
    }

    #guestbook td{
      vertical-align: middle;
    }

    .topbar{
      min-height: var(--header-h);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 18px;
      border-bottom: var(--border);
      background: #fff;
      gap: 12px;
    }

    .topbar-left{
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 0;
    }

    .logo{
      width: 120px;
      height: 120px;
      object-fit: contain;
      border-radius: 8px;
      max-width:none;
      max-height:none;
      flex-shrink: 0;
    }

    .brand-block{
      display: flex;
      flex-direction: column;
      min-width: 0;
    }

    .brand-name{
      font-size: 18px;
      font-weight: 700;
      line-height: 1.1;
      text-align: center;
    }

    .brand-meta{
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
      font-size: 13px;
      color: #555;
    }

    .meta-item{
      color: #555;
      text-decoration: none;
      text-align: center;
      display: inline-block;
    }

    .meta-item:hover{
      text-decoration: underline;
    }

    .topbar-right{
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .book-btn{
      display: inline-flex;
      align-items: center;
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.15);

      background: linear-gradient(
        90deg,
        #ffe6e6,
        #fff2cc,
        #e6ffea,
        #e6f0ff,
        #f0e6ff
      );

      color: #000;
      text-decoration: none;
      font-size: 13px;
      font-weight: 700;

      box-shadow: 0 1px 3px rgba(0,0,0,0.12);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      white-space: nowrap;
    }

    .book-btn:hover{
      transform: translateY(-1px);
      box-shadow: 0 3px 6px rgba(0,0,0,0.18);
    }

    .topbar-mid{
      flex: 1;
      overflow: hidden;
      position: relative;
      height: 100%;
    }

    .video-runner{
      display: flex;
      align-items: center;
      gap: 16px;
      position: absolute;
      left: -300px;
      top: 50%;
      transform: translateY(-50%);
      animation: run-across 8s linear infinite;
    }

    .video-runner img,
    .video-runner video{
      height: 180px;
      width: auto;
      display: block;
    }

    @keyframes run-across{
      0%   { left: -140px; }
      100% { left: 100%; }
    }

    /* Phone layout */
    @media (max-width: 700px){
      .topbar-mid{ display: none; }
      .topbar{ padding: 10px 12px; gap: 8px; }
      .logo{ width: 60px; height: 60px; }
      .content{ grid-template-columns: 1fr; }

       /* Make Guest Name column thinner
      #guestbook th:nth-child(1),
      #guestbook td:nth-child(1){
          width: 75%;
        max-width: 75%;
        white-space: normal;   /* allow wrapping */
        word-break: break-word;
      } */
    }
  </style>
</head>

<body>
  <div class="page">
    <header class="topbar">
      <div class="topbar-left">
        <img class="logo" src="Logo.jpg" alt="JB Resort logo">
        <div class="brand-block">
          <div class="brand-name">JB Resort</div>
          <div class="brand-meta">
            <span class="meta-item">3423 Cindys LN<br>Sebring FL 33870<br><br>863-840-0362</span>
          </div>
        </div>
      </div>

      <div class="topbar-mid">
        <div class="video-runner">
          <img class="logo" src="IMG_2793.jpg" alt="Campground">
          <video src="JamieDance.mp4" autoplay muted loop playsinline></video>
          <img class="logo" src="IMG_2711.jpg" alt="GuestPullingIn">
          <img class="logo" src="ArrowRight.png" alt="==>">
        </div>
      </div>

      <div class="topbar-right">
        <a class="book-btn"
           href="https://www.hipcamp.com/en-US/land/florida-jb-resort-6p0h0nn5?searchSource=homepage-autocomplete&adults=1&children=0&srid=34460cee-91a9-4e8c-822b-dc8ec7984009"
           target="_blank"
           rel="noopener">
          Book on HipCamp
        </a>
      </div>
    </header>

    <main>
      <div class="content">
        <section class="panel" id="infoPane">
          <h2>Info</h2>
          <div class="muted">
            Gay-Owned and Operated &mdash; but anybody over 21 is welcome.<br><br>
            As a Mini-Resort, we only have 3 RV lots and one "cabin" &mdash; a travel trailer.<br><br>
            We supply the beautiful and spacious grounds including pool, hot-tub, pool table, bar/clubhouse (BYOB).<br><br>
            10 minutes from downtown Sebring and shopping.<br><br>
            Our 12.5 acres are fully fenced in. Nice for walking.<br><br>
            We're dog-friendly. Dogs can run free. But please be responsible for your dog.<br><br>
            Events: We're too small to schedule events &mdash; by time we listed one, we'd be full. The events are what you make. Get some of your camping friends to meet up here. That's when weekends tend to be the most fun.<br><br>
          </div>
        </section>

        <section class="panel" id="guestbookPane">
          <h2>Guestbook</h2>
          <p class="panel-sub">Search, sort, and browse our guests book. Please note the "Category" option.</p>

          <div id="filters-row">
            <div id="category-filter">
              <label>
                Category:
                <select id="categoryFilter">
                  <option value="">All</option>
                </select>
              </label>
            </div>
          </div>

          <table id="guestbook" class="display" style="width:100%">
            <thead>
              <tr>
                <th>Guest Name</th>
                <th>Check-in</th>
                <th>Check-out</th>
                <th>Site</th>
                <th>Category</th>
                <th>Photo</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </section>
      </div>
    </main>
  </div>

  <script>
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTTS02kw1t7eCQm5ZFa-nvfO10qy4tqCscorUBjwCvDp9guyMAFw1GONtXQUZsK6IQG2RJUw2Bfuy3P/pub?gid=0&single=true&output=csv";

    function parseCSV(text) {
      const rows = [];
      let row = [];
      let cell = "";
      let inQuotes = false;

      for (let i = 0; i < text.length; i++) {
        const char = text[i];
        const next = text[i + 1];

        if (char === '"' && inQuotes && next === '"') { cell += '"'; i++; continue; }
        if (char === '"') { inQuotes = !inQuotes; continue; }

        if (char === ',' && !inQuotes) { row.push(cell); cell = ""; continue; }
        if ((char === '\n' || char === '\r') && !inQuotes) {
          if (cell.length || row.length) { row.push(cell); rows.push(row); }
          row = []; cell = "";
          if (char === '\r' && next === '\n') i++;
          continue;
        }
        cell += char;
      }
      if (cell.length || row.length) { row.push(cell); rows.push(row); }
      return rows;
    }

    function toEmbeddableImageUrl(url) {
      const u = String(url || "").trim();

      let m = u.match(/drive\.google\.com\/file\/d\/([^\/]+)/i);
      if (m && m[1]) return `https://lh3.googleusercontent.com/d/${m[1]}=w400`;

      m = u.match(/[?&]id=([^&]+)/i);
      if (m && m[1] && /drive\.google\.com\/uc/i.test(u)) {
        return `https://lh3.googleusercontent.com/d/${m[1]}=w400`;
      }

      return u;
    }

    function escapeHtml(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function escapeRegExp(s) {
      return s.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    }

    async function loadGuestbook() {
      const res = await fetch(CSV_URL, { cache: "no-store" });
      if (!res.ok) throw new Error("Could not load CSV. Check your published link.");
      const text = await res.text();
      const data = parseCSV(text);

      const [headers, ...rows] = data;

      const colIndex = (name) =>
        headers.findIndex(h => (h || "").trim().toLowerCase() === name);

      const idxName = colIndex("guest name");
      const idxIn   = colIndex("check-in");
      const idxOut  = colIndex("check-out");
      const idxSite = colIndex("site");
      const idxCategory = colIndex("category");
      const idxPhoto = colIndex("photo");

      if ([idxName, idxIn, idxOut, idxSite, idxCategory].some(i => i < 0)) {
        throw new Error("CSV headers must include: Guest Name, Check-in, Check-out, Site, Category");
      }

      const tbody = document.querySelector("#guestbook tbody");
      tbody.innerHTML = "";

      for (const r of rows) {
        if (!r || r.every(c => !String(c || "").trim())) continue;

        const rawPhotoUrl = (idxPhoto >= 0) ? (r[idxPhoto] || "").trim() : "";
        const imgUrl = rawPhotoUrl ? toEmbeddableImageUrl(rawPhotoUrl) : "";

        const photoCell = imgUrl
          ? `<a href="${escapeHtml(rawPhotoUrl)}" target="_blank" rel="noopener">
               <img src="${escapeHtml(imgUrl)}"
                    alt="Guest photo"
                    class="photo-thumb"
                    loading="lazy">
             </a>`
          : "";

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${escapeHtml(r[idxName] || "")}</td>
          <td>${escapeHtml(r[idxIn] || "")}</td>
          <td>${escapeHtml(r[idxOut] || "")}</td>
          <td>${escapeHtml(r[idxSite] || "")}</td>
          <td>${escapeHtml(r[idxCategory] || "")}</td>
          <td>${photoCell}</td>
        `;
        tbody.appendChild(tr);
      }

      const categoryColIndex = 4;

      if ($.fn.dataTable.isDataTable('#guestbook')) {
        $('#guestbook').DataTable().destroy();
      }

      const table = $('#guestbook').DataTable({
        dom: 'ftrip',
        pageLength: 25,
        order: [[1, 'desc']],
        columnDefs: [
          { targets: [5], orderable: false, searchable: false },
          { targets: [1,2], type: 'date' }
        ],
        initComplete: function () {
          const api = this.api();
          const select = document.getElementById("categoryFilter");

          select.innerHTML = '<option value="">All</option>';

          const values = api.column(categoryColIndex).data().toArray()
            .map(v => String(v || "").trim())
            .filter(v => v.length > 0);

          Array.from(new Set(values))
            .sort((a,b)=>a.localeCompare(b))
            .forEach(cat => {
              const opt = document.createElement("option");
              opt.value = cat;
              opt.textContent = cat;
              select.appendChild(opt);
            });

          select.addEventListener("change", () => {
            const v = select.value;
            api.column(categoryColIndex)
              .search(v ? `^${escapeRegExp(v)}$` : "", true, false)
              .draw();
          });
        }
      });

      // Phone-only hide/show for Check-out column (index 2)
      function updateCheckoutVisibility(){
        const isPhone = window.matchMedia("(max-width: 700px)").matches;
        table.column(2).visible(!isPhone);
        table.column(3).visible(!isPhone);
        table.column(4).visible(!isPhone);
      }

      updateCheckoutVisibility();
      window.addEventListener("resize", updateCheckoutVisibility);
    }

    loadGuestbook().catch(err => {
      document.body.insertAdjacentHTML("beforeend",
        `<p style="color:#b00020;padding:12px;"><b>Error:</b> ${escapeHtml(err.message)}</p>`
      );
    });
  </script>
</body>
</html>
