<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JB Resort</title>

  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>

  <style>
    :root{
      --page-max: 1200px;
      --gap: 16px;
      --border: 1px solid #ddd;
      --radius: 12px;
      --pad: 14px;
      --header-h: 180px;
      --shadow: 0 1px 6px rgba(0,0,0,0.06);
      --tab-h: 44px;
    }

    body{
      margin: 0;
      scrollbar-gutter: stable;
      font-family: Arial, sans-serif;
      background: #fafafa;
      color: #111;
    }

    .page{
      min-height: 100vh;
      display: grid;
      grid-template-rows: var(--header-h) 1fr;
    }

    main{
      display: flex;
      justify-content: center;
      padding: var(--gap);
    }

    .content{
      width: 100%;
      max-width: var(--page-max);
      display: block;
    }

    .panel{
      background: #fff;
      border: var(--border);
      border-radius: var(--radius);
      padding: var(--pad);
      box-shadow: var(--shadow);
    }

    .panel h2{
      margin: 0 0 10px 0;
      font-size: 16px;
    }

    .muted{
      color: #555;
      font-size: 13px;
      line-height: 1.45;
    }

    .panel-sub{
      color: #444;
      margin: 0 0 12px 0;
      font-size: 13px;
    }

    table.dataTable thead th { white-space: nowrap; }

    #filters-row{
      display: flex;
      justify-content: flex-end;
      margin-bottom: 6px;
    }

    #category-filter label{
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: normal;
    }

    #categoryFilter{
      padding: 4px 6px;
      font-size: 13px;
    }

    .dataTables_filter{
      margin-bottom: 10px;
      float: right;
      text-align: right;
    }

    .photo-thumb{
      width: 40px;
      height: 40px;
      object-fit: cover;
      border-radius: 4px;
      display: block;
      margin: 0 auto;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    .photo-thumb:hover{
      transform: scale(1.15);
      box-shadow: 0 2px 8px rgba(0,0,0,0.25);
    }

    #guestbook td{
      vertical-align: middle;
    }

    /* Top bar */
    .topbar{
      min-height: var(--header-h);
      display: grid;
      grid-template-columns: auto 1fr; /* left stays as thin as its content */
      align-items: center;
      padding: 0 18px;
      border-bottom: var(--border);
      background: #fff;
      gap: 12px;
    }
.topbar-left{
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 0;
    }

    .logo{
      width: 120px;
      height: 120px;
      object-fit: contain;
      border-radius: 8px;
      max-width:none;
      max-height:none;
      flex-shrink: 0;
    }

    .brand-block{
      display: flex;
      flex-direction: column;
      min-width: 0;
    }

    .brand-name{
      font-size: 18px;
      font-weight: 700;
      line-height: 1.1;
      text-align: center;
    }

    .brand-meta{
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
      font-size: 13px;
      color: #555;
    }

    .meta-item{
      color: #555;
      text-decoration: none;
      text-align: center;
      display: inline-block;
    }

    .meta-item:hover{
      text-decoration: underline;
    }

    .topbar-right{
      display: flex;
      justify-content: center; /* centered within the wide right cell */
      align-items: center;
      gap: 10px;
      min-width: 0;
    }
.book-btn{
      display: inline-flex;
      align-items: center;
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.15);

      background: linear-gradient(
        90deg,
        #ffe6e6,
        #fff2cc,
        #e6ffea,
        #e6f0ff,
        #f0e6ff
      );

      color: #0645ad;
      text-decoration: underline;
      font-size: 13px;
      font-weight: 700;

      box-shadow: 0 1px 3px rgba(0,0,0,0.12);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      white-space: nowrap;
    }

    .book-btn:hover{
      transform: translateY(-1px);
      box-shadow: 0 3px 6px rgba(0,0,0,0.18);
    }
    /* Tabs */
    .tabs{
      margin-bottom: var(--gap);
      background: #fff;
      border: var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .tablist{
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      padding: 6px;
      border-bottom: var(--border);
      background: #fff;
    }

    .tab-btn{
      appearance: none;
      box-sizing: border-box;

      border: 1px solid rgba(0,0,0,0.18); /* always present to keep width stable */
      background: #fff;

      padding: 10px 12px;
      min-height: var(--tab-h);

      border-radius: 10px;
      font-weight: 700;
      font-size: 13px;
      cursor: pointer;
      color: #333;
      white-space: nowrap;
      flex: 0 0 auto; /* stable sizing; phone layout handled in media query */
    }

    .tab-btn:hover{
      background: #f7f7f7;
    }

    .tab-btn:focus-visible{
      outline: 2px solid rgba(6,69,173,0.45);
      outline-offset: 2px;
    }

    .tab-btn[aria-selected="true"]{
      background: #111;
      color: #fff;
      border-color: #111; /* same border width, so no reflow */
    }

    .tab-panels{
      padding: var(--pad);
    }

    .tab-panel{
      display: none;
    }

    .tab-panel.active{
      display: block;
    }


    /* Photos grid */
    .photo-grid{
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: flex-start;
    }

    .photo-item{
      position: relative;
      width: 160px;
    }

    .photo-item img{
      cursor: zoom-in;
      width: 160px;
      height: 120px;
      object-fit: cover;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.12);
      box-shadow: 0 1px 3px rgba(0,0,0,0.10);
      display: block;
    }

    .photo-tip{
      position: absolute;
      left: 50%;
      bottom: calc(100% + 8px);
      transform: translateX(-50%);
      max-width: 260px;
      width: max-content;
      padding: 8px 10px;
      background: rgba(17,17,17,0.92);
      color: #fff;
      font-size: 12px;
      line-height: 1.35;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.25);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.12s ease;
      z-index: 5;
      white-space: normal;
    }

    .photo-tip::after{
      content: "";
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 7px solid transparent;
      border-top-color: rgba(17,17,17,0.92);
    }

    .photo-item:hover .photo-tip{
      opacity: 1;
    }

    .section-subtitle{
      background: #e6f0ff;          /* same pale blue as button */
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 700;
      color: #111;
      margin: 0 0 10px 0;
    }

    .rules-list{
      display: grid;
      grid-template-columns: 160px 1fr;
      gap: 8px 16px;
      font-size: 13px;
      line-height: 1.45;
    }

    .rules-list dt{
      font-weight: 700;
      color: #111;
    }

    .rules-list dd{
      margin: 0;
      color: #555;
    }

    /* Phone-friendly */
    @media (max-width: 600px){
      .rules-list{
        grid-template-columns: 1fr;
      }
      .rules-list dt{
        margin-top: 8px;
      }
    }

    /* Phone layout */
    @media (max-width: 1300px){
.topbar{ padding: 10px 12px; gap: 8px; grid-template-columns: auto 1fr; }
      .logo{ width: 60px; height: 60px; }

      /* Make Guest column thinner (still helpful on phone) */
      #guestbook th:nth-child(1),
      #guestbook td:nth-child(1){
        width: 85%;
        max-width: 75%;
        white-space: normal;
        word-break: break-word;
      }

      .tab-btn{
        flex: 1 1 auto;
      }

      .photo-item,
      .photo-item img{
      cursor: zoom-in;
        width: 150px;
      }
      .photo-item img{
      cursor: zoom-in;
        height: 112px;
      }
    }
  
    /* Phone: keep tab wrapping stable (2 columns) */
    @media (max-width: 700px){
      .tablist{
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 6px;
      }
      .tab-btn{
        width: 100%;
        white-space: normal; /* allow wrap inside the tab instead of reflowing the bar */
        text-align: center;
      }
    }

    /* Photos: full-size viewer (below top bar, inside Photos tab) */
    .photo-viewer{
      display: none;
      border: var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      background: #fff;
      padding: 10px;
      margin-top: 10px;
    }
    .photo-viewer.active{ display: block; }

    .photo-viewer-top{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }

    .photo-viewer-title{
      font-weight: 700;
      font-size: 13px;
      color: #333;
    }

    .photo-viewer-close{
      appearance: none;
      border: 1px solid rgba(0,0,0,0.18);
      background: #fff;
      border-radius: 10px;
      padding: 8px 10px;
      font-weight: 700;
      font-size: 12px;
      cursor: pointer;
    }
    .photo-viewer-close:hover{ background: #f7f7f7; }

    .photo-viewer img{
      width: 100%;
      max-height: 75vh;          /* fill most of the page below the top bar */
      object-fit: contain;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.12);
      background: #fafafa;
      display: block;
    }

    .photo-viewer-caption{
      margin-top: 8px;
      color: #555;
      font-size: 13px;
      line-height: 1.45;
    }

    /* When viewer is open, hide the thumbnail grid */
    .photo-grid.hidden{ display: none; }

    /* Map tab layout */
    .map-block{
      display: grid;
      gap: 14px;
    }

    .map-top{
      display: grid;
      grid-template-columns: 1.6fr 1fr;
      gap: 14px;
      align-items: start;
    }

    .map-img img{
      width: 100%;
      height: auto;
      display: block;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.12);
      box-shadow: 0 1px 3px rgba(0,0,0,0.10);
      background: #fafafa;
    }

    .map-legend{
      border: 1px solid rgba(0,0,0,0.12);
      border-radius: 10px;
      padding: 12px;
      background: #fff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    }

    .legend-list{
      margin: 0;
      padding-left: 18px;
      color: #555;
      font-size: 13px;
      line-height: 1.6;
    }

    .legend-list li{
      margin: 4px 0;
    }

    .map-bottom img{
      width: 100%;
      height: auto;
      display: block;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.12);
      box-shadow: 0 1px 3px rgba(0,0,0,0.10);
      background: #fafafa;
    }

    @media (max-width: 800px){
      .map-top{
        grid-template-columns: 1fr;
      }
    }

</style>
</head>

<body>
  <div class="page">
    <header class="topbar">
      <div class="topbar-left">
        <img class="logo" src="Logo.jpg" alt="JB Resort logo">
        <div class="brand-block">
          <div class="brand-name">JB Resort</div>
          <div class="brand-meta">
            <span class="meta-item">3423 Cindys LN<br>Sebring FL 33870<br>...<br>863-840-0362</span>
          </div>
        </div>
      </div>
      <div class="topbar-right">
        <a class="book-btn"
           href="https://www.hipcamp.com/en-US/land/florida-jb-resort-6p0h0nn5?searchSource=homepage-autocomplete&adults=1&children=0&srid=34460cee-91a9-4e8c-822b-dc8ec7984009"
           target="_blank"
           rel="noopener">
          Book on HipCamp
        </a>
      </div>
    </header>

    <main>
      <div class="content">
        <div class="tabs panel" id="tabsRoot">
          <div class="tablist" role="tablist" aria-label="JB Resort tabs">
            <button class="tab-btn" role="tab" aria-selected="true"  aria-controls="tab-home"         id="btn-home"        data-tab="home">Home</button>
            <button class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-map"          id="btn-map"         data-tab="map">Map</button>
            <button class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-rules"        id="btn-rules"       data-tab="rules">Details & Rules</button>
            <button class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-available"    id="btn-available"  data-tab="available">Available Dates</button>
            <button class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-guestbook"    id="btn-guestbook"   data-tab="guestbook">Guestbook</button>
            <button class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-photos"       id="btn-photos"      data-tab="photos">Photos</button>
            <button class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-attractions"  id="btn-attractions" data-tab="attractions">Attractions</button>
            <button class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-shopping"     id="btn-shopping"    data-tab="shopping">Shopping</button>
            <button class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-restaurants"  id="btn-restaurants" data-tab="restaurants">Restaurants and Bars</button>
          </div>

          <div class="tab-panels">
            <!-- HOME -->
            <section class="tab-panel active" id="tab-home" role="tabpanel" aria-labelledby="btn-home">
              <h2>Home</h2>
              <div class="muted">
                Gay-Owned and Operated &mdash; but anybody over 21 is welcome.<br><br>
                As a Mini-Resort, we only have 3 RV lots and one "cabin" &mdash; a travel trailer.<br><br>
                We supply the beautiful and spacious grounds including pool, hot-tub, pool table, bar/clubhouse (BYOB).<br><br>
                10 minutes from downtown Sebring and shopping.<br><br>
                Our 12.5 acres are fully fenced in. Nice for walking.<br><br>
                We're dog-friendly. Dogs can run free. But please be responsible for your dog.<br><br>
                Events: We're too small to schedule events &mdash; by time we listed one, we'd be full. The events are what you make. Get some of your camping friends to meet up here. That's when weekends tend to be the most fun.<br><br>Please ask about exclusive gay male, clothing optional dates.
              </div>
            </section>

            <!-- GUESTBOOK -->
            <section class="tab-panel" id="tab-guestbook" role="tabpanel" aria-labelledby="btn-guestbook">
              <h2>Guestbook</h2>
              <p class="panel-sub">Search, sort, and browse our guests book. Please note the "Category" option.</p>

              <div id="filters-row">
                <div id="category-filter">
                  <label>
                    Category:
                    <select id="categoryFilter">
                      <option value="">All</option>
                    </select>
                  </label>
                </div>
              </div>

              <table id="guestbook" class="display" style="width:100%">
                <thead>
                  <tr>
                    <th>Guest</th>
                    <th>Check-in</th>
                    <th>Check-out</th>
                    <th>Site</th>
                    <th>Category</th>
                    <th>Photo</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </section>

            <!-- ATTRACTIONS -->
            <section class="tab-panel" id="tab-attractions" role="tabpanel" aria-labelledby="btn-attractions">
              <h2>Attractions</h2>
              <!--<p class="panel-sub">This table is loaded from a published Google Sheet (CSV).</p>-->
              <table id="attractionsTable" class="display" style="width:100%">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Address</th>
                    <th>Phone Number</th>
                    <th>Website</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </section>

            <!-- SHOPPING -->
            <section class="tab-panel" id="tab-shopping" role="tabpanel" aria-labelledby="btn-shopping">
              <h2>Shopping</h2>
              <!--<p class="panel-sub">This table is loaded from a published Google Sheet (CSV).</p>-->
              <table id="shoppingTable" class="display" style="width:100%">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Address</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </section>

            <!-- RESTAURANTS -->
            <section class="tab-panel" id="tab-restaurants" role="tabpanel" aria-labelledby="btn-restaurants">
              <h2>Restaurants and Bars</h2>

              <h3 class="section-subtitle">Our Favorite Restaurants and Bars</h3>
              <table id="favRestaurantsTable" class="display" style="width:100%; margin-bottom: 18px;">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Address</th>
                    <th>Phone Number</th>
                    <th>Website</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>

              <h3 class="section-subtitle">Other Popular Restaurants and Bars</h3>
              <table id="otherRestaurantsTable" class="display" style="width:100%">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Address</th>
                    <th>Phone Number</th>
                    <th>Website</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </section>

            <!-- PHOTOS -->
            <section class="tab-panel" id="tab-photos" role="tabpanel" aria-labelledby="btn-photos">
              <h2>Photos</h2>
              <p class="panel-sub">Hover a photo to see its description.</p>
              <div id="photoGrid" class="photo-grid"></div>
              <div id="photoViewer" class="photo-viewer" aria-hidden="true">
                <div class="photo-viewer-top">
                  <div class="photo-viewer-title">Photo</div>
                  <button type="button" id="photoViewerClose" class="photo-viewer-close">Back to thumbnails</button>
                </div>
                <img id="photoViewerImg" src="" alt="">
                <div id="photoViewerCaption" class="photo-viewer-caption"></div>
              </div>
            </section>


            <!-- MAP -->
            <section class="tab-panel" id="tab-map" role="tabpanel" aria-labelledby="btn-map">
              <h2>Map</h2>

              <div class="map-block">
                <div class="map-top">
                  <div class="map-img">
                    <img src="SiteMap.png" alt="JB Resort site map">
                  </div>

                  <div class="map-legend">
                    <h3 class="section-subtitle" style="margin-top:0;">Legend</h3>
                    <ul class="legend-list">
                      <li><b>1:</b> Front Cement Pad</li>
                      <li><b>2:</b> RV Port</li>
                      <li><b>3:</b> Behind Barn</li>
                      <li><b>4:</b> Grove</li>
                      <li><b>5:</b> Cabin: Stationary RV, Not in Photo.</li>
                    </ul>
                  </div>
                </div>

                <div class="map-bottom">
                  <img src="Property.png" alt="JB Resort property overview">
                  <img src="CityView.png" alt="JB Resort City View">
                </div>
              </div>
            </section>
            
            <!-- AVAILABLE DATES -->
            <section class="tab-panel" id="tab-available" role="tabpanel" aria-labelledby="btn-available">
              <h2>Available Dates</h2>
              <div class="muted">
               <p>
                HipCamp and Airbnb work well when you already know your travel dates,
                but they aren't very helpful for quickly seeing what is currently available.
                </p>

                <p>
                Please call or text me, Bolton, at <b>863-840-0362</b>,
                and I'll be happy to help you plan your visit.
                </p>              
              </div>
            </section>

            <!-- RULES -->
            <section class="tab-panel" id="tab-rules" role="tabpanel" aria-labelledby="btn-rules">
              <h2>Details & Rules</h2>
              <div class="muted">
                <dl class="rules-list">

                  <dt>Wi-Fi</dt>
                  <dd>
                    Netgear4E1D5F (password: sharedsecret);<br>
                    NetgearBolton5 (password: were88*NOT);<br>
                    JamiesBarn (password: JamiesBarn)
                  </dd>

                  <dt>Owner's Dogs</dt>
                  <dd>
                    Black (female): Diva;<br>
                    White/Tan (female): Artemis
                  </dd>

                  <dt>Your Dogs</dt>
                  <dd>
                    Dogs may run free on the property.
                    Please supervise your dog at all times and ensure they do not approach other guests without permission.
                    Respect other guests' preferences regarding interaction with pets.
                  </dd>

                  <dt>Trash</dt>
                  <dd>
                    Use any of the three trash cans across the main drive, partially hidden by trees.
                    The county does not recycle.
                    Please do not leave trash outside your RV unless secured—dogs may get into it.
                  </dd>

                  <dt>Pool</dt>
                  <dd>
                    Unheated; uses saltwater or chlorine depending on water temperature.
                  </dd>

                  <dt>Hot tub</dt>
                  <dd>
                    Please rinse before use.
                    Close the lid after use when daytime temperatures are below 70°F.
                  </dd>

                  <dt>Outdoor shower</dt>
                  <dd>
                    Located next to the pool.
                    Water may take up to two minutes to heat and can become very hot.
                  </dd>

                  <dt>Fence</dt>
                  <dd>
                    The entire property is fully fenced.
                  </dd>

                  <dt>Washer &amp; Dryer</dt>
                  <dd>
                    Located in the garage (large silver Quonset hut).
                    Ask for the access code if locked.
                  </dd>

                  <dt>Guests</dt>
                  <dd>
                    Please ask Bolton or Jamie before inviting guests.
                    For insurance purposes, all guests must be booked through HipCamp.
                  </dd>

                  <dt>Septic system</dt>
                  <dd>
                    Do not flush wipes, feminine hygiene products, condoms, makeup wipes,
                    or paper towels. These items will clog the septic pump.
                  </dd>

                  <dt>Quiet hours</dt>
                  <dd>
                    10:30 PM – 8:00 AM (Sun–Thu); 11:00 PM – 8:00 AM (Fri–Sat)
                  </dd>

                  <dt>Parking</dt>
                  <dd>
                    Park only in designated areas.
                    Do not block walkways, doors, or driveways.
                  </dd>

                  <dt>Firewood</dt>
                  <dd>
                    Use by permission only.
                    Limited supply available.
                    Firewood may be purchased at Home Depot or Lowe’s.
                  </dd>

                  <dt>Fires</dt>
                  <dd>
                    Fires must be in a portable off-ground pit or designated pit.
                    No fires in grass areas or during county fire bans.
                  </dd>

                  <dt>Personal property</dt>
                  <dd>
                    Owners are not responsible for lost or damaged items.
                    Secure all belongings properly.
                  </dd>

                </dl>

              </div>
            </section>

          </div>
        </div>

      </div>
    </main>
  </div>

  <script>
    // =========================
    // 1) GOOGLE SHEETS CSV URLS
    // =========================
    // Replace these with your published CSV URLs from Google Sheets:
    const GUESTBOOK_CSV_URL   = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTTS02kw1t7eCQm5ZFa-nvfO10qy4tqCscorUBjwCvDp9guyMAFw1GONtXQUZsK6IQG2RJUw2Bfuy3P/pub?gid=0&single=true&output=csv";
    const ATTRACTIONS_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTAApH23Ok726BA7XBqmxTn04qoJCiVWq60FFLNnyk1TDX-xaX2VoO7HU-gufFsnfm_8AXt0XKj1Ng9/pub?output=csv";
    const SHOPPING_CSV_URL    = "https://docs.google.com/spreadsheets/d/e/2PACX-1vThwtZc8tlbqCEVTp4PYVrNX_2khq2y3LCd-eUkdTAq_c7GzewSo7-FDppM_jFomGXmIO55fCLlpVlr/pub?output=csv";
    const FAV_REST_CSV_URL    = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTn-HTP6GPliB3QLmUmpLi_7Ymm5RxlvrnTdKb5BJWiC0PwbapVhfeS49lXdAkIOWo6-aLSnSW0VblD/pub?output=csv";
    const OTHER_REST_CSV_URL  = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQf0XdMJqOBxr7oEYZzaZVbU3zqAkiDHwDb3cR2tWDk0IMiU0uhNq2epY1mmbLgQP9TwCpcnL3e18t3/pub?output=csv";
    const PHOTOS_CSV_URL      = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR3OXVxGJPKaKXXumLRvXZM4V1-dd8b-ZUqNE8Thtjlw6PPf_ryc6OCYPs0mB_Gv8xHhp0NSDfPATWo/pub?gid=0&single=true&output=csv";

    // =========================
    // 2) TAB SWITCHING
    // =========================
    const tabButtons = Array.from(document.querySelectorAll(".tab-btn"));
    const tabPanels  = Array.from(document.querySelectorAll(".tab-panel"));

    function setActiveTab(tabName){
      tabButtons.forEach(btn => {
        const on = btn.dataset.tab === tabName;
        btn.setAttribute("aria-selected", on ? "true" : "false");
      });

      tabPanels.forEach(p => {
        p.classList.toggle("active", p.id === "tab-" + tabName);
      });

      // Lazy-init DataTables when a tab is opened (prevents width bugs)
      if (tabName === "guestbook" && !window.__guestbookInitialized) {
        window.__guestbookInitialized = true;
        loadGuestbook();
      }

      if (tabName === "attractions" && !window.__attractionsInitialized) {
        window.__attractionsInitialized = true;
        loadSimpleTable(ATTRACTIONS_CSV_URL, "#attractionsTable", [
          "name", "description", "address", "phone number", "website"
        ], { linkColumns: ["website"] });
      }

      if (tabName === "shopping" && !window.__shoppingInitialized) {
        window.__shoppingInitialized = true;
        loadSimpleTable(SHOPPING_CSV_URL, "#shoppingTable", [
          "name", "address"
        ]);
      }

      if (tabName === "restaurants" && !window.__restaurantsInitialized) {
        window.__restaurantsInitialized = true;
        loadSimpleTable(FAV_REST_CSV_URL, "#favRestaurantsTable", [
          "name", "description", "address", "phone number", "website"
        ], { linkColumns: ["website"] });

        loadSimpleTable(OTHER_REST_CSV_URL, "#otherRestaurantsTable", [
          "name", "description", "address", "phone number", "website"
        ], { linkColumns: ["website"] });
      }

      if (tabName === "photos" && !window.__photosInitialized) {
        window.__photosInitialized = true;
        loadPhotos();
      }

      // save
      try { localStorage.setItem("jb_active_tab", tabName); } catch(e) {}
    }

    tabButtons.forEach(btn => {
      btn.addEventListener("click", () => setActiveTab(btn.dataset.tab));
    });

    // Restore last tab (optional)
    try {
      const last = localStorage.getItem("jb_active_tab");
      if (last) setActiveTab(last);
    } catch(e) {}

    // =========================
    // 3) CSV helpers
    // =========================
    function parseCSV(text) {
      const rows = [];
      let row = [];
      let cell = "";
      let inQuotes = false;

      for (let i = 0; i < text.length; i++) {
        const char = text[i];
        const next = text[i + 1];

        if (char === '"' && inQuotes && next === '"') { cell += '"'; i++; continue; }
        if (char === '"') { inQuotes = !inQuotes; continue; }

        if (char === ',' && !inQuotes) { row.push(cell); cell = ""; continue; }
        if ((char === '\n' || char === '\r') && !inQuotes) {
          if (cell.length || row.length) { row.push(cell); rows.push(row); }
          row = []; cell = "";
          if (char === '\r' && next === '\n') i++;
          continue;
        }
        cell += char;
      }
      if (cell.length || row.length) { row.push(cell); rows.push(row); }
      return rows;
    }

    function escapeHtml(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function escapeRegExp(s) {
      return s.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    }

    function toEmbeddableImageUrl(url) {
      const u = String(url || "").trim();

      let m = u.match(/drive\.google\.com\/file\/d\/([^\/]+)/i);
      if (m && m[1]) return `https://lh3.googleusercontent.com/d/${m[1]}=w800`;

      m = u.match(/[?&]id=([^&]+)/i);
      if (m && m[1] && /drive\.google\.com\/uc/i.test(u)) {
        return `https://lh3.googleusercontent.com/d/${m[1]}=w800`;
      }

      return u;
    }

    async function fetchCsvRows(csvUrl){
      if (!csvUrl) return null;
      const res = await fetch(csvUrl, { cache: "no-store" });
      if (!res.ok) throw new Error("Could not load CSV. Check your published link.");
      const text = await res.text();
      const data = parseCSV(text);
      const [headers, ...rows] = data;
      return { headers, rows };
    }

    // =========================
    // 4) Guestbook (existing)
    // =========================
    async function loadGuestbook() {
      const payload = await fetchCsvRows(GUESTBOOK_CSV_URL);
      if (!payload) return;
      const { headers, rows } = payload;

      const colIndex = (name) =>
        headers.findIndex(h => (h || "").trim().toLowerCase() === name);

      const idxName = colIndex("guest");
      const idxIn   = colIndex("check-in");
      const idxOut  = colIndex("check-out");
      const idxSite = colIndex("site");
      const idxCategory = colIndex("category");
      const idxPhoto = colIndex("photo");

      if ([idxName, idxIn, idxOut, idxSite, idxCategory].some(i => i < 0)) {
        throw new Error("Guestbook CSV headers must include: Guest, Check-in, Check-out, Site, Category");
      }

      const tbody = document.querySelector("#guestbook tbody");
      tbody.innerHTML = "";

      for (const r of rows) {
        if (!r || r.every(c => !String(c || "").trim())) continue;

        const rawPhotoUrl = (idxPhoto >= 0) ? (r[idxPhoto] || "").trim() : "";
        const imgUrl = rawPhotoUrl ? toEmbeddableImageUrl(rawPhotoUrl) : "";

        const photoCell = imgUrl
          ? `<a href="${escapeHtml(rawPhotoUrl)}" target="_blank" rel="noopener">
               <img src="${escapeHtml(imgUrl)}"
                    alt="Guest photo"
                    class="photo-thumb"
                    loading="lazy">
             </a>`
          : "";

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${escapeHtml(r[idxName] || "")}</td>
          <td>${escapeHtml(r[idxIn] || "")}</td>
          <td>${escapeHtml(r[idxOut] || "")}</td>
          <td>${escapeHtml(r[idxSite] || "")}</td>
          <td>${escapeHtml(r[idxCategory] || "")}</td>
          <td>${photoCell}</td>
        `;
        tbody.appendChild(tr);
      }

      const categoryColIndex = 4;

      if ($.fn.dataTable.isDataTable('#guestbook')) {
        $('#guestbook').DataTable().destroy();
      }

      const table = $('#guestbook').DataTable({
        dom: 'ftrip',
        pageLength: 25,
        order: [[1, 'desc']],
        columnDefs: [
          { targets: [5], orderable: false, searchable: false },
          { targets: [1,2], type: 'date' }
        ],
        initComplete: function () {
          const api = this.api();
          const select = document.getElementById("categoryFilter");

          select.innerHTML = '<option value="">All</option>';

          const values = api.column(categoryColIndex).data().toArray()
            .map(v => String(v || "").trim())
            .filter(v => v.length > 0);

          Array.from(new Set(values))
            .sort((a,b)=>a.localeCompare(b))
            .forEach(cat => {
              const opt = document.createElement("option");
              opt.value = cat;
              opt.textContent = cat;
              select.appendChild(opt);
            });

          select.addEventListener("change", () => {
            const v = select.value;
            api.column(categoryColIndex)
              .search(v ? `^${escapeRegExp(v)}$` : "", true, false)
              .draw();
          });
        }
      });

      // Phone-only hide/show for Check-out, Site, Category columns (indexes 2,3,4)
      function updateCheckoutVisibility(){
        const isPhone = window.matchMedia("(max-width: 700px)").matches;
        table.column(2).visible(!isPhone); // Check-out
        table.column(3).visible(!isPhone); // Site
        table.column(4).visible(!isPhone); // Category
      }

      updateCheckoutVisibility();
      window.addEventListener("resize", updateCheckoutVisibility);
    }

    // =========================
    // 5) Generic tables
    // =========================
    async function loadSimpleTable(csvUrl, tableSelector, expectedColumnsLower, opts){
      opts = opts || {};
      const payload = await fetchCsvRows(csvUrl);
      if (!payload){
        // Leave empty if URL not set
        return;
      }

      const { headers, rows } = payload;
      const headersLower = headers.map(h => String(h || "").trim().toLowerCase());

      function idx(colLower){
        return headersLower.findIndex(h => h === colLower);
      }

      const indices = expectedColumnsLower.map(c => idx(c));
      if (indices.some(i => i < 0)){
        throw new Error(`CSV for ${tableSelector} is missing one or more headers. Expected: ${expectedColumnsLower.join(", ")}`);
      }

      const tbody = document.querySelector(tableSelector + " tbody");
      tbody.innerHTML = "";

      for (const r of rows){
        if (!r || r.every(c => !String(c || "").trim())) continue;

        const tr = document.createElement("tr");
        const tds = expectedColumnsLower.map((colLower, j) => {
          const raw = (r[indices[j]] || "").trim();
          const safe = escapeHtml(raw);

          // Turn "Website" into clickable link if present
          if (opts.linkColumns && opts.linkColumns.includes(colLower) && raw){
            const href = raw.startsWith("http") ? raw : ("https://" + raw);
            return `<td><a href="${escapeHtml(href)}" target="_blank" rel="noopener">${safe}</a></td>`;
          }

          return `<td>${safe}</td>`;
        });

        tr.innerHTML = tds.join("");
        tbody.appendChild(tr);
      }

      if ($.fn.dataTable.isDataTable(tableSelector)) {
        $(tableSelector).DataTable().destroy();
      }

      $(tableSelector).DataTable({
        dom: 'ftrip',
        pageLength: 25,
        order: [],
        autoWidth: false
      });
    }

    // =========================
    // 6) Photos (grid w/ hover)
    // =========================
    async function loadPhotos(){
      const grid = document.getElementById("photoGrid");
      grid.innerHTML = "";

      const payload = await fetchCsvRows(PHOTOS_CSV_URL);
      if (!payload){
        grid.innerHTML = '<div class="muted">Photos CSV URL is not set yet. Publish a Google Sheet and paste the CSV link into <b>PHOTOS_CSV_URL</b>.</div>';
        return;
      }

      const { headers, rows } = payload;
      const headersLower = headers.map(h => String(h || "").trim().toLowerCase());

      // Expected headers: Photo, Description (optional: Link)
      const idxPhoto = headersLower.findIndex(h => h === "photo" || h === "image" || h === "image url");
      const idxDesc  = headersLower.findIndex(h => h === "description" || h === "caption");
      const idxLink  = headersLower.findIndex(h => h === "link" || h === "website" || h === "url");

      if (idxPhoto < 0 || idxDesc < 0){
        throw new Error("Photos CSV headers must include: Photo (or Image/Image URL) and Description (or Caption).");
      }

      for (const r of rows){
        if (!r || r.every(c => !String(c || "").trim())) continue;

        const rawPhoto = (r[idxPhoto] || "").trim();
        const desc     = (r[idxDesc]  || "").trim();
        const rawLink  = (idxLink >= 0) ? (r[idxLink] || "").trim() : "";

        if (!rawPhoto) continue;

        const imgUrl = toEmbeddableImageUrl(rawPhoto);
        const safeDesc = escapeHtml(desc || "");

        const item = document.createElement("div");
        item.className = "photo-item";

        const img = document.createElement("img");
        img.src = imgUrl;
        img.alt = desc ? desc : "Photo";
        img.loading = "lazy";
        img.dataset.fullsrc = imgUrl;
        img.dataset.caption = desc || "";

        const tip = document.createElement("div");
        tip.className = "photo-tip";
        tip.innerHTML = safeDesc || "&nbsp;";

        if (rawLink){
          const href = rawLink.startsWith("http") ? rawLink : ("https://" + rawLink);
          const a = document.createElement("a");
          a.href = href;
          a.target = "_blank";
          a.rel = "noopener";
          a.appendChild(img);

          // Clicking the photo opens the large viewer instead of navigating away
          a.addEventListener("click", (e) => {
            e.preventDefault();
            openPhotoViewer(img.dataset.fullsrc, img.dataset.caption);
          });

          item.appendChild(a);
        } else {
          img.addEventListener("click", () => {
            openPhotoViewer(img.dataset.fullsrc, img.dataset.caption);
          });
          item.appendChild(img);
        }

        item.appendChild(tip);
        grid.appendChild(item);
      }
    }

    // Photos: open a full-size viewer below the top bar (inside the Photos tab)
    function openPhotoViewer(imgSrc, captionText){
      const grid = document.getElementById("photoGrid");
      const viewer = document.getElementById("photoViewer");
      const viewerImg = document.getElementById("photoViewerImg");
      const viewerCap = document.getElementById("photoViewerCaption");

      if (!grid || !viewer || !viewerImg || !viewerCap) return;

      viewerImg.src = imgSrc;
      viewerImg.alt = captionText ? captionText : "Photo";
      viewerCap.textContent = captionText || "";

      grid.classList.add("hidden");
      viewer.classList.add("active");
      viewer.setAttribute("aria-hidden", "false");

      // Scroll into view so the large image is immediately visible
      viewer.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    function closePhotoViewer(){
      const grid = document.getElementById("photoGrid");
      const viewer = document.getElementById("photoViewer");
      const viewerImg = document.getElementById("photoViewerImg");

      if (!grid || !viewer || !viewerImg) return;

      viewer.classList.remove("active");
      viewer.setAttribute("aria-hidden", "true");
      viewerImg.src = "";

      grid.classList.remove("hidden");
      grid.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    // Wire up the close button once
    document.getElementById("photoViewerClose")?.addEventListener("click", closePhotoViewer);


    // =========================
    // 7) Error display
    // =========================
    window.addEventListener("unhandledrejection", (ev) => {
      const msg = ev?.reason?.message ? ev.reason.message : String(ev.reason || "Unknown error");
      document.body.insertAdjacentHTML("beforeend",
        `<p style="color:#b00020;padding:12px;"><b>Error:</b> ${escapeHtml(msg)}</p>`
      );
    });
  </script>
</body>
</html>
